<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{.Category.Title}}</title>
	<style>
		:root {
			--background-color: #f3f4f6;
			--text-color: #374151;
			--container-background: #ffffff;
			--header-title-color: #1f2937;
			--header-date-color: #6b7280;
			--group-title-color: #6b7280;
			--entry-background: #f9fafb;
			--entry-border-color: #e5e7eb;
			--entry-focus-shadow: rgba(59, 130, 246, 0.5);
			--entry-focus-border: #3b82f6;
			--entry-summary-color: #1d4ed8;
			--entry-open-background: #e0f2fe;
			--entry-open-border: #bfdbfe;
			--entry-active-shadow: rgba(234, 88, 12, 0.7);
			--entry-active-border: #ea580c;
			--entry-active-background: #fff7ed;
			--entry-meta-text-color: #6b7280;
			--entry-meta-border-color: #e5e7eb;
			--entry-content-text-color: #4b5563;
			--entry-link-color: #3b82f6;
			--entry-link-focus-background: rgba(59, 130, 246, 0.1);
		}

		@media (prefers-color-scheme: dark) {
			:root {
				--background-color: #1f2937;
				--text-color: #d1d5db;
				--container-background: #111827;
				--header-title-color: #f9fafb;
				--header-date-color: #9ca3af;
				--group-title-color: #9ca3af;
				--entry-background: #374151;
				--entry-border-color: #4b5563;
				--entry-focus-shadow: rgba(96, 165, 250, 0.5);
				--entry-focus-border: #60a5fa;
				--entry-summary-color: #93c5fd;
				--entry-open-background: #374151;
				--entry-open-border: #4b5563;
				--entry-active-shadow: rgba(251, 146, 60, 0.7);
				--entry-active-border: #fb923c;
				--entry-active-background: #4a2c13;
				--entry-meta-text-color: #9ca3af;
				--entry-meta-border-color: #4b5563;
				--entry-content-text-color: #d1d5db;
				--entry-link-color: #00ff00; /* Vibrant green for unvisited links */
				--entry-visited-link-color: #00cc00; /* Muted green for visited links */
				--entry-link-focus-background: rgba(96, 165, 250, 0.1);
			}
		}

		a {
			color: var(--entry-link-color);
		}

		a:visited {
			color: var(--entry-visited-link-color);
		}

		body {
			font-family: sans-serif;
			background-color: var(--background-color);
			color: var(--text-color);
			line-height: 1.6;
			margin: 0;
			padding: 0;
		}

		.container {
			max-width: 800px;
			margin: 2rem auto;
			padding: 1.5rem;
		}

		section.header {
			margin-bottom: 1.5rem;
			text-align: center;
		}

		section.header h1.title {
			font-size: 1.875rem;
			font-weight: 700;
			color: var(--header-title-color);
			margin-bottom: 0.25rem;
		}

		section.header .date {
			font-size: 0.875rem;
			color: var(--header-date-color);
		}

		section.summary p {
			margin: 1rem auto;
			padding: 0.5rem 1rem;
			background-color: var(--container-background);
			border: 1px solid var(--entry-border-color);
			border-radius: 0.5rem;
		}

		h2.group-entries-title {
			font-size: 1.25rem;
			font-weight: 500;
			color: var(--group-title-color);
			margin-top: 0.5rem;
			margin-bottom: 0.5rem;
			padding-left: 0.5rem;
		}

		section.entry {
			background-color: var(--entry-background);
			border-radius: 0.5rem;
			padding: 0;
			margin-bottom: 1rem;
			border: 1px solid var(--entry-border-color);
		}

		section.entry:focus-within {
			box-shadow: 0 0 0 3px var(--entry-focus-shadow);
			border-color: var(--entry-focus-border);
		}

		summary.entry {
			font-size: 1.25rem;
			font-weight: 600;
			padding: 0.5rem;
			cursor: pointer;
			color: var(--entry-summary-color);
			text-decoration: none;
			list-style: none;
			position: relative;
		}

		summary.entry:focus {
			outline: none;
		}

		section.entry:has(details[open]) {
			background-color: var(--entry-open-background);
			border-color: var(--entry-open-border);
		}

		section.entry.active {
			box-shadow: 0 0 0 3px var(--entry-active-shadow);
			border-color: var(--entry-active-border);
			background-color: var(--entry-active-background);
		}

		section.entry.viewed:not(.active) {
			opacity: 0.8;
			filter: grayscale(100%);
		}

		section.entry.viewed:not(.active) summary.entry {
			font-weight: 400;
		}

		.entry-meta {
			font-size: 0.875rem;
			color: var(--entry-meta-text-color);
			display: flex;
			flex-direction: row;
			gap: 0.25rem;
			align-items: center;
			justify-content: start;
			border-top: 1px solid var(--entry-meta-border-color);
		}

		.entry-meta-tab {
			padding: 0.25rem 0.5rem;
			border-right: 1px solid var(--entry-meta-border-color);
			display: flex;
		}

		.entry-meta-tab-feed {
			display: flex;
			align-items: center;
			gap: 0.25rem;
		}

		.entry-meta-tab:last-child {
			border-right: none;
		}

		.entry-content {
			font-size: 1rem;
			color: var(--entry-content-text-color);
			padding: 1rem;
			overflow-wrap: break-word;
		}

		.entry-content img {
			max-width: 100%;
			height: auto;
			border-radius: 0.25rem;
			margin-top: 0.5rem;
		}

		.no-entries {
			text-align: center;
			font-style: italic;
			color: var(--text-color);
			padding: 2rem;
		}

		a.entry-link {
			color: var(--entry-link-color);
			text-decoration: none;
		}

		a.entry-link:hover {
			text-decoration: underline;
		}

		a.entry-link:focus {
			outline: 2px solid var(--entry-link-color);
			outline-offset: 2px;
			border-radius: 0.25rem;
			background-color: var(--entry-link-focus-background);
		}

		details.entry {}

		details.entry h1 {
			font-size: 1.5rem;
			margin-top: 1rem;
			margin-bottom: 0.5rem;
		}

		details summary {
			cursor: pointer;
		}

		details summary > * {
			display: inline;
		}

		{{range .FeedIcons}}
		div.feed-icon-{{.FeedID}} {
			background-image: url("data:{{.Data}}");
			background-size: contain;
			width: 16px;
			height: 16px;
		}
		{{end}}
	</style>
</head>

<body>
	<div class="container">
		<section class="header">
			<h1 class="title">{{.Category.Title}}</h1>
			<span class="date"><a href="{{$.MinifluxHost}}/category/{{.Category.ID}}/entries" target="_blank" rel="noopener noreferrer" class="category-link">category feed</a> generated on {{.GeneratedDate.Format "Jan 2, 2006"}}</span>
		</section>

		<section class="summary">
			<h2 class="group-entries-title">Summary</h2>
			<p>{{.Summary}}</p>
		</section>

		<section class="entries">
			{{if .EntryGroups}}
			{{range .EntryGroups}}
			<h2 class="group-entries-title">{{.Title}}</h2>
			{{range .Entries}}
			<section class="entry">
				<details class="entry">
					<summary class="entry">
						{{.Title}}
					</summary>
					<div class="entry-content">
						{{ htmlEscape .Content}}
					</div>
				</details>
				<div class="entry-meta">
					<div class="entry-meta-tab entry-meta-tab-feed">
						<div class="feed-icon-{{.FeedID}}"></div>
						<div>{{.Feed.Title}}</div>
					</div>
					<div class="entry-meta-tab">{{.Date.Format "2 Jan"}}</div>
					<div class="entry-meta-tab" style="margin-left: auto;">
						<a href="{{.URL}}" target="_blank" rel="noopener noreferrer"
							class="entry-link" data-link-external>permalink</a>
					</div>
					{{if .CommentsURL}}
					<div class="entry-meta-tab">
						<a href="{{.CommentsURL}}" target="_blank" rel="noopener noreferrer"
							class="entry-link" data-link-comments>comments</a>
					</div>
					{{end}}
					<div class="entry-meta-tab">
						<a href="{{$.MinifluxHost}}/feed/{{.FeedID}}/entry/{{.ID}}" target="_blank"
							rel="noopener noreferrer" class="entry-link"
							data-link-internal>source</a>
					</div>
					<div class="entry-meta-tab">
						<a href="#" class="entry-link" data-button-mark>hide</a>
					</div>
				</div>
			</section>
			{{end}}
			{{end}}
			{{else}}
			<div class="no-entries">No unread entries in this category.</div>
			{{end}}
		</section>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const entries = Array.from(document.querySelectorAll('section.entry'));
			let activeEntryIndex = -1;

			function setActiveEntry(index) {
				if (entries.length === 0) return;

				if (activeEntryIndex !== -1 && entries[activeEntryIndex]) {
					const activeEntry = entries[activeEntryIndex];
					activeEntry?.classList.remove('active');
					activeEntry?.classList.add('viewed');
				}

				activeEntryIndex = index;

				if (activeEntryIndex >= 0 && activeEntryIndex < entries.length) {
					const activeEntry = entries[activeEntryIndex];
					const summary = activeEntry?.querySelector('summary');

					activeEntry?.classList.add('active');
					summary?.focus()
				}
			}

			function removeEntry(index) {
				if (index >= 0 && index < entries.length) {
					const entry = entries[index];
					entry.remove();
					entries.splice(index, 1);
					setActiveEntry(index);
				}
			}

			if (entries.length > 0) {
				setActiveEntry(0);
			}

			
			document.addEventListener('click', (event) => {
				if (event.target.matches('a[data-button-mark]')) {
					const entry = event.target.closest('section.entry');
					const index = entries.indexOf(entry);

					removeEntry(index);
				} else if (event.target.closest('section.entry')) {
					const entry = event.target.closest('section.entry');
					const index = entries.indexOf(entry);

					if (index !== -1) {
						setActiveEntry(index);
					}
				}
			});

			document.addEventListener('keydown', (event) => {
				if (['j', 'k', 'v', 'D', 'U', 'V', 'm'].includes(event.key)) {
					event.preventDefault();

					switch (event.key) {
						case 'm':
							removeEntry(activeEntryIndex);
							break;
						case 'j':
							setActiveEntry(activeEntryIndex + 1);
							break;
						case 'U':
							setActiveEntry(entries.length - 1);
							break;
						case 'k':
							setActiveEntry(activeEntryIndex - 1);
							break;
						case 'D':
							setActiveEntry(0);
							break;
						case 'V':
							if (activeEntryIndex !== -1 && entries[activeEntryIndex]) {
								const currentEntry = entries[activeEntryIndex];
								const link = currentEntry.querySelector('a[data-link-internal]');

								if (link && link.href) {
									window.open(link.href, '_blank');
								}
							}
							break;
						case 'v':
							if (activeEntryIndex !== -1 && entries[activeEntryIndex]) {
								const currentEntry = entries[activeEntryIndex];
								const link = currentEntry.querySelector('a[data-link-external]');

								if (link && link.href) {
									window.open(link.href, '_blank');
								}
							}
							break;
					}
				}
			});
		});
	</script>
</body>

</html>
